<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>User Attendance Interface</title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
</head>

<body>
  <div class="container-fluid">
    <div class="row min-vh-100">
      <div class="col-12 p-0">
        <main class="d-flex flex-column h-100">

          <!-- Page Content -->
          <div class="container-fluid overflow-auto mt-2">
            <section class="p-3">
              <div class="card">
                <div class="card-header bg-dark text-white">
                  <h5 class="mb-0">Attendance</h5>
                </div>
                <div class="card-body">

                  <!-- Filters -->
                  <div class="row mb-3">
                    <div class="col-md-2">
                      <input type="text" id="filterStudentId" class="form-control" placeholder="Student ID">
                    </div>
                    <div class="col-md-2">
                      <input type="text" id="filterDeviceId" class="form-control" placeholder="Device ID">
                    </div>
                    <div class="col-md-2">
                      <input type="text" id="filterDeviceName" class="form-control" placeholder="Device Name">
                    </div>
                    <div class="col-md-2">
                      <input type="text" id="filterClass" class="form-control" placeholder="Class">
                    </div>
                    <div class="col-md-2">
                      <input type="text" id="filterSection" class="form-control" placeholder="Section">
                    </div>
                    <div class="col-md-2">
                      <select id="filterStatus" class="form-select">
                        <option value="">All Status</option>
                        <option value="Present">Present</option>
                        <option value="Absent">Absent</option>
                        <option value="Late">Late</option>
                      </select>
                    </div>
                  </div>

                  <!-- Table -->
                  <div class="table-responsive">
                    <table class="table table-striped table-hover mb-0">
                      <thead class="table-light">
                        <tr>
                          <th>S.No</th>
                          <th>Student ID</th>
                          <th>Student Name</th>
                          <th>Device ID</th>
                          <th>Device Name</th>
                          <th>Class</th>
                          <th>Section</th>
                          <th>Address</th>
                          <th>Contact</th>
                          <th>Status</th>
                        </tr>
                      </thead>
                      <tbody id="attendanceTableBody">
                        <!-- Filled dynamically -->
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </section>
          </div>

        </main>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Script to fetch data -->
  <script>
    // Load students and devices data from localStorage
    const students = JSON.parse(localStorage.getItem("students")) || [];
    const devices = JSON.parse(localStorage.getItem("devices")) || [];

    // Example attendance status (You can modify logic)
    const statusList = ["Present", "Absent", "Late"];

    function loadAttendanceTable() {
      const tbody = document.getElementById("attendanceTableBody");
      tbody.innerHTML = "";

      let filtered = students.map((stu, index) => {
        const device = devices.find(d => d.deviceId === stu.deviceId) || {};
        return {
          sno: index + 1,
          studentId: stu.studentId,
          studentName: stu.name,
          deviceId: stu.deviceId || "-",
          deviceName: device.deviceName || "-",
          class: stu.class || "-",
          section: stu.section || "-",
          address: stu.address || "-",
          contact: stu.contact || "-",
          status: statusList[Math.floor(Math.random() * statusList.length)]
        };
      });

      // Apply filters
      const fStuId = document.getElementById("filterStudentId").value.toLowerCase();
      const fDevId = document.getElementById("filterDeviceId").value.toLowerCase();
      const fDevName = document.getElementById("filterDeviceName").value.toLowerCase();
      const fClass = document.getElementById("filterClass").value.toLowerCase();
      const fSec = document.getElementById("filterSection").value.toLowerCase();
      const fStatus = document.getElementById("filterStatus").value;

      filtered = filtered.filter(row =>
        (fStuId === "" || row.studentId.toLowerCase().includes(fStuId)) &&
        (fDevId === "" || row.deviceId.toLowerCase().includes(fDevId)) &&
        (fDevName === "" || row.deviceName.toLowerCase().includes(fDevName)) &&
        (fClass === "" || row.class.toLowerCase().includes(fClass)) &&
        (fSec === "" || row.section.toLowerCase().includes(fSec)) &&
        (fStatus === "" || row.status === fStatus)
      );

      // Render table rows
      filtered.forEach(row => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${row.sno}</td>
          <td>${row.studentId}</td>
          <td>${row.studentName}</td>
          <td>${row.deviceId}</td>
          <td>${row.deviceName}</td>
          <td>${row.class}</td>
          <td>${row.section}</td>
          <td>${row.address}</td>
          <td>${row.contact}</td>
          <td>${row.status}</td>
        `;
        tbody.appendChild(tr);
      });
    }

    // Load table on start
    loadAttendanceTable();

    // Re-load table when filters change
    document.querySelectorAll("#filterStudentId, #filterDeviceId, #filterDeviceName, #filterClass, #filterSection, #filterStatus")
      .forEach(el => el.addEventListener("input", loadAttendanceTable));
  </script>
</body>

</html>
