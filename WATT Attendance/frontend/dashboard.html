<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Attendance</title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Bootstrap Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
</head>

<body>
  <!-- <div class="container-fluid mt-4">
    <div class="row min-vh-100">
      
          <nav class="navbar navbar-expand-lg bg-body-tertiary px-3 mb-3">
            <div class="container-fluid">
              <strong class="navbar-brand" id="pageTitle">Dashboard</strong>
            </div>
          </nav> -->

      <!-- Main Content -->
      <div class="col-12 bg-white">
        <main class="d-flex flex-column min-vh-100 p-4">
          <section>

            <!-- Attendance Summary -->
            <div class="row text-center mb-4">
              <div class="col-md-3 mb-3">
                <div class="card border-success shadow">
                  <div class="card-body">
                    <h6 class="text-success">Present</h6>
                    <p id="presentCount" class="fs-4 fw-bold mb-0">0</p>
                  </div>
                </div>
              </div>
              <div class="col-md-3 mb-3">
                <div class="card border-danger shadow">
                  <div class="card-body">
                    <h6 class="text-danger">Absent</h6>
                    <p id="absentCount" class="fs-4 fw-bold mb-0">0</p>
                  </div>
                </div>
              </div>
              <div class="col-md-3 mb-3">
                <div class="card border-warning shadow">
                  <div class="card-body">
                    <h6 class="text-warning">Late</h6>
                    <p id="lateCount" class="fs-4 fw-bold mb-0">0</p>
                  </div>
                </div>
              </div>
              <div class="col-md-3 mb-3">
                <div class="card border-primary shadow">
                  <div class="card-body">
                    <h6 class="text-primary">Attendance %</h6>
                    <p id="attendancePercent" class="fs-4 fw-bold mb-0">0%</p>
                  </div>
                </div>
              </div>
            </div>

            <!-- Attendance Log -->
            <div class="d-flex flex-column bg-white p-3 rounded shadow">
              <h3>ðŸ“† Daily Attendance Log</h3><br>

              <!-- âœ… Filters Row -->
              <form id="filterForm" class="row g-3 align-items-end">
                <!-- Class -->
                <div class="col-md-2">
                  <label class="form-label mb-0">Class:</label>
                  <input type="text" id="filterClass" class="form-control" placeholder="Enter Class (e.g. 1,2,3)">
                </div>

                <!-- Section -->
                <div class="col-md-2">
                  <label class="form-label mb-0">Section:</label>
                  <input type="text" id="filterSection" class="form-control" placeholder="Enter Section (e.g. A,B)">
                </div>

                <!-- Status -->
                <div class="col-md-2">
                  <label class="form-label mb-0">Status:</label>
                  <select id="filterStatus" class="form-select">
                    <option value="">All</option>
                    <option value="Present">Present</option>
                    <option value="Absent">Absent</option>
                    <option value="Late">Late</option>
                  </select>
                </div>

                <!-- From Date -->
                <div class="col-md-2">
                  <label class="form-label mb-0">From Date:</label>
                  <input type="date" id="dateFrom" class="form-control">
                </div>

                <!-- To Date -->
                <div class="col-md-2">
                  <label class="form-label mb-0">To Date:</label>
                  <input type="date" id="dateTo" class="form-control">
                </div>

                <!-- Search -->
                <div class="col-md-1">
                  <button class="btn btn-outline-primary w-100" type="submit">Search</button>
                </div>

                <!-- Export -->
                <div class="col-md-1 text-end">
                  <button class="btn btn-outline-primary w-100" type="button" onclick="downloadCSV()">
                    â¬‡ Export
                  </button>
                </div>
              </form>

              <!-- Attendance Table -->
              <div class="my-4">
                <div class="table-responsive">
                  <table class="table table-bordered table-hover">
                    <thead class="table-light">
                      <tr>
                        <th>Device ID</th>
                        <th>Student ID</th>
                        <th>Student Name</th>
                        <th>Class</th>
                        <th>Section</th>
                        <th>Date</th>
                        <th>Status</th>
                        <th>Check-In</th>
                        <th>Check-Out</th>
                      </tr>
                    </thead>
                    <tbody id="attendanceTable"></tbody>
                  </table>
                </div>
              </div>
            </div>
          </section>
        </main>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    // âœ… Dummy Attendance Data
    const attendanceData = [
      { deviceId: "D001", id: "S101", name: "Rahul", class: "1", section: "A", date: "2025-06-08", status: "Present", checkIn: "08:05 AM", checkOut: "02:30 PM" },
      { deviceId: "D002", id: "S102", name: "Ram", class: "1", section: "A", date: "2025-06-08", status: "Present", checkIn: "08:05 AM", checkOut: "02:30 PM" },
      { deviceId: "D003", id: "S103", name: "Sam", class: "2", section: "B", date: "2025-06-08", status: "Absent", checkIn: "--", checkOut: "--" },
      { deviceId: "D004", id: "S104", name: "Tom", class: "3", section: "A", date: "2025-06-07", status: "Late", checkIn: "08:45 AM", checkOut: "02:30 PM" }
    ];

    // âœ… Render Table
    function renderTable(data) {
      const tbody = document.getElementById("attendanceTable");
      tbody.innerHTML = "";

      if (data.length === 0) {
        tbody.innerHTML = <tr><td colspan="9" class="text-center text-muted">No records found</td></tr>;
        return;
      }

      data.forEach(a => {
        const badgeClass = a.status === "Present" ? "success" : a.status === "Absent" ? "danger" : "warning text-dark";
        tbody.innerHTML += `
          <tr>
            <td>${a.deviceId}</td>
            <td>${a.id}</td>
            <td><i class="bi bi-person-circle"></i> ${a.name}</td>
            <td>${a.class}</td>
            <td>${a.section}</td>
            <td>${a.date}</td>
            <td><span class="badge bg-${badgeClass}">${a.status}</span></td>
            <td>${a.checkIn}</td>
            <td>${a.checkOut}</td>
          </tr>
        `;
      });

      updateSummary(data);
    }

    // âœ… Update Summary Cards
    function updateSummary(data) {
      const present = data.filter(a => a.status === "Present").length;
      const absent = data.filter(a => a.status === "Absent").length;
      const late = data.filter(a => a.status === "Late").length;
      const total = data.length;

      document.getElementById("presentCount").innerText = present;
      document.getElementById("absentCount").innerText = absent;
      document.getElementById("lateCount").innerText = late;
      document.getElementById("attendancePercent").innerText = total ? ((present / total) * 100).toFixed(1) + "%" : "0%";
    }

    // âœ… Apply Filters
    document.getElementById("filterForm").addEventListener("submit", function (e) {
      e.preventDefault();

      const filterClass = document.getElementById("filterClass").value.trim();
      const filterSection = document.getElementById("filterSection").value.trim();
      const filterStatus = document.getElementById("filterStatus").value;
      const dateFrom = document.getElementById("dateFrom").value;
      const dateTo = document.getElementById("dateTo").value;

      let filtered = [...attendanceData];

      if (filterClass) filtered = filtered.filter(a => a.class === filterClass);
      if (filterSection) filtered = filtered.filter(a => a.section.toLowerCase() === filterSection.toLowerCase());
      if (filterStatus) filtered = filtered.filter(a => a.status === filterStatus);
      if (dateFrom) filtered = filtered.filter(a => a.date >= dateFrom);
      if (dateTo) filtered = filtered.filter(a => a.date <= dateTo);

      renderTable(filtered);
    });

    // âœ… Download CSV
    function downloadCSV() {
      let csv = "Device ID,Student ID,Student Name,Class,Section,Date,Status,Check-In,Check-Out\n";
      attendanceData.forEach(a => {
        csv += ${a.deviceId},${a.id},${a.name},${a.class},${a.section},${a.date},${a.status},${a.checkIn},${a.checkOut}\n;
      });

      const blob = new Blob([csv], { type: "text/csv" });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = "attendance_report.csv";
      link.click();
    }

    // âœ… Initial Load
    renderTable(attendanceData);
  </script>
</body>
</html>