<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Staff Details</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
  <style>
    .details-container { display: flex; gap: 2rem; align-items: flex-start; }
    .staff-info { flex: 2; }
    .profile-frame { width: 20rem; height: 25rem; border: 3px solid #ddd; border-radius: 0.5rem; overflow: hidden; background-color: #f8f9fa; display: flex; flex-direction: column; align-items: center; justify-content: center; margin-left: -10rem; padding: 1rem; }
    .profile-frame img { width: 100%; height: 100%; object-fit: cover; border-radius: 0.25rem; }
    .upload-btn { margin-top: 0.75rem; width: 100%; }
  </style>
</head>
<body class="bg-light">
  <div class="container py-5">
    <a href="staff.html" class="btn btn-outline-dark mb-3"><i class="bi bi-arrow-left"></i> Back</a>
    <div class="card shadow p-3">
      <div class="details-container">
        <div class="staff-info">
          <h3 id="staffName"></h3>
          <p><strong>Staff ID:</strong> <span id="staffId"></span></p>
          <p><strong>Father's Name:</strong> <span id="fatherName"></span></p>
          <p><strong>Mother's Name:</strong> <span id="motherName"></span></p>
          <p><strong>Date of Birth:</strong> <span id="dob"></span></p>
          <p><strong>Gender:</strong> <span id="gender"></span></p>
          <p><strong>Marital Status:</strong> <span id="maritalStatus"></span></p>
          <p><strong>Email:</strong> <span id="email"></span></p>
          <p><strong>Personal Contact:</strong> <span id="personalContact"></span></p>
          <p><strong>Alternative Contact:</strong> <span id="altContact"></span></p>
          <p><strong>Address:</strong> <span id="address"></span></p>
          <p><strong>City:</strong> <span id="city"></span></p>
          <p><strong>State:</strong> <span id="state"></span></p>
          <p><strong>Pincode:</strong> <span id="pincode"></span></p>
          <p><strong>Joining Date:</strong> <span id="joiningDate"></span></p>
          <p><strong>Job Title:</strong> <span id="jobTitle"></span></p>
          <p><strong>Department:</strong> <span id="department"></span></p>
          <button class="btn btn-info" id="editStaff">Edit Details</button>
        </div>

        <div class="profile-frame">
          <img id="profilePhoto" src="https://via.placeholder.com/150" alt="Profile Photo">
          <input type="file" class="form-control upload-btn" id="uploadPhoto" accept="image/*">
        </div>
      </div>
    </div>
  </div>

  <script>
    const params = new URLSearchParams(window.location.search);
    const staffId = params.get("id");
    let staffList = JSON.parse(localStorage.getItem("staffList")) || [];
    let staff = staffList.find(s => s.staffId === staffId);

    function fillStaffDetails(s) {
      document.getElementById("staffName").innerText = s.fullName;
      document.getElementById("staffId").innerText = s.staffId;
      document.getElementById("fatherName").innerText = s.fatherName;
      document.getElementById("motherName").innerText = s.motherName;
      document.getElementById("dob").innerText = s.dob;
      document.getElementById("gender").innerText = s.gender;
      document.getElementById("maritalStatus").innerText = s.maritalStatus;
      document.getElementById("email").innerText = s.email;
      document.getElementById("personalContact").innerText = s.personalContact;
      document.getElementById("altContact").innerText = s.altContact;
      document.getElementById("address").innerText = s.address;
      document.getElementById("city").innerText = s.city;
      document.getElementById("state").innerText = s.state;
      document.getElementById("pincode").innerText = s.pincode;
      document.getElementById("joiningDate").innerText = s.joiningDate;
      document.getElementById("jobTitle").innerText = s.jobTitle;
      document.getElementById("department").innerText = s.department;
      if(s.photo) document.getElementById("profilePhoto").src = s.photo;
    }

    if(staff) fillStaffDetails(staff);

    // Edit button
    document.getElementById("editStaff").addEventListener("click", function() {
      if(!staff) return;
      const query = new URLSearchParams(staff).toString();
      window.location.href = "addStaff.html?" + query;
    });

    // Upload photo
    document.getElementById("uploadPhoto").addEventListener("change", function(event){
      const reader = new FileReader();
      reader.onload = function(){
        document.getElementById("profilePhoto").src = reader.result;
        if(staff){
          staff.photo = reader.result;
          const index = staffList.findIndex(s => s.staffId === staff.staffId);
          staffList[index] = staff;
          localStorage.setItem("staffList", JSON.stringify(staffList));
        }
      };
      reader.readAsDataURL(event.target.files[0]);
    });
  </script>
</body>
</html>
