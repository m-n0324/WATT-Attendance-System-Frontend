<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Student Details</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">

  <style>
    .details-container {
      display: flex;
      gap: 2rem;
      align-items: flex-start;
      margin-top: 1rem;
    }

    .student-info {
      flex: 2;
    }

    .profile-frame {
      width: 20rem;
      height: 25rem;
      border: 3px solid #ddd;
      border-radius: 0.5rem;
      overflow: hidden;
      background-color: #f8f9fa;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 1rem;
    }

    .profile-frame img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .info-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 1rem;
    }

    .info-grid p {
      margin-bottom: 0;
    }

    .info-item {
      display: flex;
      flex-direction: column;
    }
  </style>
</head>

<body>
  <div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h2 id="studentName"></h2>
      <div class="d-flex gap-2">
        <a id="editStudent" class="btn btn-warning"><i class="bi bi-pencil-square"></i> Edit</a>
        <button id="deleteStudent" class="btn btn-danger"><i class="bi bi-trash"></i> Delete</button>
      </div>
    </div>

    <div class="details-container">
      <div class="profile-frame">
        <img id="profilePhoto" src="https://via.placeholder.com/300" alt="Student Photo">
        <button class="btn btn-outline-primary mt-3" onclick="document.getElementById('uploadPhoto').click()">
          <i class="bi bi-camera"></i> Change Photo
        </button>
        <input type="file" id="uploadPhoto" accept="image/*" style="display: none;">
      </div>

      <div class="student-info">
        <h3 class="mb-3">Personal Information</h3>
        <div class="info-grid">
          <div class="info-item"><strong>Student ID:</strong><span id="studentId"></span></div>
          <div class="info-item"><strong>Class:</strong><span id="class"></span></div>
          <div class="info-item"><strong>Section:</strong><span id="section"></span></div>
          <div class="info-item"><strong>Gender:</strong><span id="gender"></span></div>
          <div class="info-item"><strong>Date of Birth:</strong><span id="dob"></span></div>
          <div class="info-item"><strong>Contact No:</strong><span id="contact"></span></div>
          <div class="info-item"><strong>Email:</strong><span id="email"></span></div>
          <div class="info-item"><strong>Address:</strong><span id="address"></span></div>
          <div class="info-item"><strong>City:</strong><span id="city"></span></div>
          <div class="info-item"><strong>State:</strong><span id="state"></span></div>
          <div class="info-item"><strong>Pincode:</strong><span id="pincode"></span></div>
          <div class="info-item"><strong>Transport:</strong><span id="transport"></span></div>
        </div>

        <h3 class="mt-4 mb-3">Parent Information</h3>
        <div class="info-grid">
          <div class="info-item"><strong>Father's Name:</strong><span id="fatherName"></span></div>
          <div class="info-item"><strong>Mother's Name:</strong><span id="motherName"></span></div>
          <div class="info-item"><strong>Father's Occupation:</strong><span id="fatherOccupation"></span></div>
          <div class="info-item"><strong>Mother's Occupation:</strong><span id="motherOccupation"></span></div>
          <div class="info-item"><strong>Father's Mobile:</strong><span id="fatherMobile"></span></div>
          <div class="info-item"><strong>Mother's Mobile:</strong><span id="motherMobile"></span></div>
          <div class="info-item"><strong>Admission Date:</strong><span id="admissionDate"></span></div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const studentId = urlParams.get('id');
    const students = JSON.parse(localStorage.getItem('students')) || [];
    const student = students.find(s => s.studentId === studentId);

    if (!student) {
      document.getElementById('studentName').innerText = "Student Not Found";
      document.body.innerHTML = '<p class="text-center mt-5">Student not found. Please go back to the list.</p>';
    } else {
      document.getElementById('studentName').innerText = student.name;
      document.title = student.name ? Student Details - ${student.name} : 'Student Details';
      document.getElementById("studentId").innerText = student.studentId;
      document.getElementById("class").innerText = student.class || '';
      document.getElementById("section").innerText = student.section || '';
      document.getElementById("gender").innerText = student.gender || '';
      document.getElementById("dob").innerText = student.dob || '';
      document.getElementById("contact").innerText = student.contact || '';
      document.getElementById("email").innerText = student.email || '';
      document.getElementById("address").innerText = student.address || '';
      document.getElementById("city").innerText = student.city || '';
      document.getElementById("state").innerText = student.state || '';
      document.getElementById("pincode").innerText = student.pincode || '';
      document.getElementById("transport").innerText = student.transport || '';
      document.getElementById("fatherName").innerText = student.fatherName || '';
      document.getElementById("motherName").innerText = student.motherName || '';
      document.getElementById("fatherOccupation").innerText = student.fatherOccupation || '';
      document.getElementById("motherOccupation").innerText = student.motherOccupation || '';
      document.getElementById("fatherMobile").innerText = student.fatherMobile || '';
      document.getElementById("motherMobile").innerText = student.motherMobile || '';
      document.getElementById("admissionDate").innerText = student.admissionDate || '';
      if (student.photo) document.getElementById("profilePhoto").src = student.photo;
    }

    document.getElementById("editStudent").addEventListener("click", function () {
      window.location.href = addNewStudent.html?id=${student.studentId};
    });

    document.getElementById("deleteStudent").addEventListener("click", function () {
      if (confirm('Are you sure you want to delete this student?')) {
        let students = JSON.parse(localStorage.getItem('students')) || [];
        students = students.filter(s => s.studentId !== studentId);
        localStorage.setItem('students', JSON.stringify(students));
        window.location.href = 'student.html';
      }
    });

    if (window.parent) {
      window.parent.postMessage({
        type: 'updateTitle',
        title: student.name ? Details of ${student.name} : 'Student Details',
        showBack: true
      }, '*');
    }
  </script>
</body>

</html>