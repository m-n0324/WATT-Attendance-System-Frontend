<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Student Interface</title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.css">

  <style>
    main {
      padding: 20px;
    }

    .table-responsive {
      max-height: calc(100vh - 200px);
      overflow-y: auto;
    }
  </style>
</head>

<body>
  <main class="container-fluid">
    <!-- Table -->
    <div class="table-responsive">
      <table id="studentTable" class="table table-bordered table-hover align-middle shadow-sm">
        <thead class="table-dark text-center">
          <tr>
            <th>Sno.</th>
            <th>Student Name</th>
            <th>Class</th>
            <th>Section</th>
            <th>Date of Birth</th>
            <th>Contact</th>
            <th>Address</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <!-- Student rows will be inserted here dynamically -->
        </tbody>
      </table>
    </div>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    function loadStudents() {
      let students = JSON.parse(localStorage.getItem('students')) || [];

      // Sort by class then section
      students.sort((a, b) => a.class - b.class || a.section.localeCompare(b.section));

      const tbody = document.querySelector('#studentTable tbody');
      tbody.innerHTML = '';
      students.forEach((s, index) => {
        const tr = document.createElement('tr');

        tr.innerHTML = `
          <td class="text-center">${index + 1}</td>
          <td><a href="#" class="text-decoration-none text-dark">${s.studentName}</a></td>
          <td class="text-center">${s.class}</td>
          <td class="text-center">${s.section}</td>
          <td class="text-center">${s.dob}</td>
          <td class="text-center">${s.contact || s.fatherMobile || ''}</td>
          <td class="text-center">${s.address}</td>
          <td class="text-center">
            <button class="btn btn-sm btn-danger me-1" onclick="deleteStudent('${s.id}')">Delete</button>
            <a href="addNewStudent.html?id=${s.id}" class="btn btn-sm btn-warning">Edit</a>
          </td>
        `;

        // When name clicked, save student object to localStorage and go to details page
        tr.querySelector('td a').addEventListener('click', function (e) {
          e.preventDefault();
          localStorage.setItem('currentStudent', JSON.stringify(s));
          window.location.href = 'studentDetails.html';
        });

        tbody.appendChild(tr);
      });
    }

    function deleteStudent(id) {
      let students = JSON.parse(localStorage.getItem('students')) || [];
      students = students.filter(s => s.id !== id);
      localStorage.setItem('students', JSON.stringify(students));
      loadStudents();
    }

    window.onload = () => {
      loadStudents();
    };
  </script>
</body>
</html>
