<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Student Form</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">

  <style>
    body, html {height: 100%; margin: 0;}
    main {min-height: 100vh; display: flex; flex-direction: column;}
    .form-container {flex-grow: 1; padding: 20px; background: #f9f9f9; overflow-y: auto;}
    fieldset {background: #fff; padding: 20px; border-radius: 12px; box-shadow: 0 0 10px rgba(0,0,0,0.1);}
    .action-buttons {margin-top: 20px; display: flex; gap: 10px;}
    #backButtonContainer {margin: 10px 20px;}
  </style>
</head>

<body>
<main>
  <nav class="navbar navbar-expand-lg bg-body-tertiary px-3 shadow-sm">
    <div class="container-fluid">
      <strong class="navbar-brand mb-0">Student Form</strong>
    </div>
  </nav>

  <div id="backButtonContainer">
    <button class="btn btn-outline-dark" onclick="history.back()">
      <i class="bi bi-arrow-left"></i> Back
    </button>
  </div>

  <div class="form-container">
    <form id="studentForm">
      <fieldset>
        <div class="row mb-3">
          <div class="col">
            <label class="form-label">Student ID</label>
            <input class="form-control" id="studentId">
          </div>
          <div class="col">
            <label class="form-label">Full Name</label>
            <input class="form-control" id="studentName">
          </div>
        </div>

        <div class="row mb-3">
          <div class="col">
            <label class="form-label">Father's Name</label>
            <input class="form-control" id="fatherName">
          </div>
          <div class="col">
            <label class="form-label">Mother's Name</label>
            <input class="form-control" id="motherName">
          </div>
        </div>

        <div class="row mb-3">
          <div class="col">
            <label class="form-label">Date of Birth</label>
            <input type="date" id="dob" class="form-control">
          </div>
          <div class="col">
            <label class="form-label">Gender</label>
            <input class="form-control" id="gender">
          </div>
          <div class="col">
            <label class="form-label">Class</label>
            <input class="form-control" id="class">
          </div>
          <div class="col">
            <label class="form-label">Section</label>
            <input class="form-control" id="section">
          </div>
          <div class="col">
            <label class="form-label">Roll Number</label>
            <input class="form-control" id="rollNumber">
          </div>
          <div class="col">
            <label class="form-label">Admission Number</label>
            <input class="form-control" id="admissionNumber">
          </div>
        </div>

        <div class="row mb-3">
          <div class="col-4">
            <label class="form-label">Email address</label>
            <input type="email" class="form-control" id="email">
          </div>
          <div class="col-2">
            <label class="form-label">Father's Mobile</label>
            <input class="form-control" id="fatherMobile">
          </div>
          <div class="col-2">
            <label class="form-label">Occupation</label>
            <input class="form-control" id="fatherOccupation">
          </div>
          <div class="col-2">
            <label class="form-label">Mother's Mobile</label>
            <input class="form-control" id="motherMobile">
          </div>
          <div class="col-2">
            <label class="form-label">Occupation</label>
            <input class="form-control" id="motherOccupation">
          </div>
        </div>

        <div class="row mb-3">
          <div class="col">
            <label class="form-label">Admission Date</label>
            <input class="form-control" id="admissionDate">
          </div>
          <div class="col">
            <label class="form-label">Address</label>
            <input class="form-control" id="address">
          </div>
          <div class="col">
            <label class="form-label">City</label>
            <input class="form-control" id="city">
          </div>
          <div class="col">
            <label class="form-label">State</label>
            <input class="form-control" id="state">
          </div>
          <div class="col">
            <label class="form-label">Pincode</label>
            <input class="form-control" id="pincode">
          </div>
          <div class="col">
            <label class="form-label">Transport Required</label>
            <input class="form-control" id="transport">
          </div>
        </div>
      </fieldset>

      <div class="action-buttons">
        <button type="button" class="btn btn-primary" id="saveBtn">Save</button>
      </div>
    </form>
  </div>
</main>

<script>
  // Get current student from localStorage if editing
  let currentStudent = JSON.parse(localStorage.getItem('currentStudent')) || null;

  // Prefill form if editing
  if (currentStudent) {
    Object.keys(currentStudent).forEach(key => {
      if (document.getElementById(key)) {
        document.getElementById(key).value = currentStudent[key];
      }
    });
  }

  document.getElementById('saveBtn').addEventListener('click', function() {
    const student = {
      studentId: document.getElementById('studentId').value.trim(),
      studentName: document.getElementById('studentName').value.trim(),
      fatherName: document.getElementById('fatherName').value.trim(),
      motherName: document.getElementById('motherName').value.trim(),
      dob: document.getElementById('dob').value.trim(),
      gender: document.getElementById('gender').value.trim(),
      class: document.getElementById('class').value.trim(),
      section: document.getElementById('section').value.trim(),
      rollNumber: document.getElementById('rollNumber').value.trim(),
      admissionNumber: document.getElementById('admissionNumber').value.trim(),
      email: document.getElementById('email').value.trim(),
      fatherMobile: document.getElementById('fatherMobile').value.trim(),
      fatherOccupation: document.getElementById('fatherOccupation').value.trim(),
      motherMobile: document.getElementById('motherMobile').value.trim(),
      motherOccupation: document.getElementById('motherOccupation').value.trim(),
      admissionDate: document.getElementById('admissionDate').value.trim(),
      address: document.getElementById('address').value.trim(),
      city: document.getElementById('city').value.trim(),
      state: document.getElementById('state').value.trim(),
      pincode: document.getElementById('pincode').value.trim(),
      transport: document.getElementById('transport').value.trim()
    };

    // Assign ID if editing or new
    if (currentStudent && currentStudent.studentId) {
      student.studentId = currentStudent.studentId;
    } else {
      student.studentId = student.studentId || Date.now().toString();
    }

    // Save to localStorage
    let students = JSON.parse(localStorage.getItem('students')) || [];
    const index = students.findIndex(s => s.studentId === student.studentId);
    if (index > -1) {
      students[index] = student; // update
      alert('Student updated successfully!');
    } else {
      students.push(student); // new
      alert('Student added successfully!');
    }

    localStorage.setItem('students', JSON.stringify(students));
    localStorage.removeItem('currentStudent'); // clear temp
    document.getElementById('studentForm').reset();
    window.location.href = 'student.html';
  });
</script>
</body>
</html>
