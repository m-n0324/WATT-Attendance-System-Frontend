<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Add Staff</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">

  <style>
    body,
    html {
      height: 100%;
      margin: 0;
    }

    main {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    .form-container {
      flex-grow: 1;
      padding: 20px;
      background: #f9f9f9;
      overflow-y: auto;
    }

    fieldset {
      background: #fff;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }

    .action-buttons {
      margin-top: 20px;
      display: flex;
      gap: 10px;
      justify-content: center;
    }
  </style>
</head>

<body>
  <main>
    <div class="container form-container">
      <form id="staffForm">
        <!-- Personal Information -->
        <fieldset>
          <legend class="text-center" id="formHeading">Add New Staff</legend>
          <div class="row g-3">
            <div class="col-md-6">
              <label class="form-label">Staff ID</label>
              <input type="text" class="form-control" name="staffId" id="staffId" required readonly>
            </div>
            <div class="col-md-6">
              <label class="form-label">Full Name</label>
              <input type="text" class="form-control" name="fullName" id="fullName" required>
            </div>
            <div class="col-md-4">
              <label class="form-label">Gender</label>
              <select class="form-select" name="gender" id="gender">
                <option value="">Select</option>
                <option value="Male">Male</option>
                <option value="Female">Female</option>
                <option value="Other">Other</option>
              </select>
            </div>
            <div class="col-md-4">
              <label class="form-label">Date of Birth</label>
              <input type="date" class="form-control" name="dob" id="dob">
            </div>
            <div class="col-md-4">
              <label class="form-label">Marital Status</label>
              <input type="text" class="form-control" name="maritalStatus" id="maritalStatus">
            </div>
            <div class="col-md-6">
              <label class="form-label">Email</label>
              <input type="email" class="form-control" name="email" id="email">
            </div>
            <div class="col-md-6">
              <label class="form-label">Personal Contact</label>
              <input type="tel" class="form-control" name="personalContact" id="personalContact">
            </div>
            <div class="col-md-6">
              <label class="form-label">Alternative Contact</label>
              <input type="tel" class="form-control" name="altContact" id="altContact">
            </div>
            <div class="col-12">
              <label class="form-label">Address</label>
              <input type="text" class="form-control" name="address" id="address">
            </div>
            <div class="col-md-4">
              <label class="form-label">City</label>
              <input type="text" class="form-control" name="city" id="city">
            </div>
            <div class="col-md-4">
              <label class="form-label">State</label>
              <input type="text" class="form-control" name="state" id="state">
            </div>
            <div class="col-md-4">
              <label class="form-label">Pincode</label>
              <input type="text" class="form-control" name="pincode" id="pincode">
            </div>
          </div>
        </fieldset>

        <!-- Family Information -->
        <fieldset class="mt-4">
          <legend class="text-center">Family Information</legend>
          <div class="row g-3">
            <div class="col-md-6">
              <label class="form-label">Father's Name</label>
              <input type="text" class="form-control" name="fatherName" id="fatherName">
            </div>
            <div class="col-md-6">
              <label class="form-label">Mother's Name</label>
              <input type="text" class="form-control" name="motherName" id="motherName">
            </div>
          </div>
        </fieldset>

        <!-- Job Information -->
        <fieldset class="mt-4">
          <legend class="text-center">Job Information</legend>
          <div class="row g-3">
            <div class="col-md-6">
              <label class="form-label">Joining Date</label>
              <input type="date" class="form-control" name="joiningDate" id="joiningDate">
            </div>
            <div class="col-md-6">
              <label class="form-label">Job Title</label>
              <input type="text" class="form-control" name="jobTitle" id="jobTitle">
            </div>
            <div class="col-md-6">
              <label class="form-label">Department</label>
              <input type="text" class="form-control" name="department" id="department">
            </div>
          </div>
        </fieldset>

        <!-- Action Buttons -->
        <div class="action-buttons">
          <button type="submit" class="btn btn-primary" id="saveBtn">Save Staff</button>
          <button type="button" class="btn btn-secondary" onclick="window.location.href='staff.html'">Cancel</button>
        </div>
      </form>
    </div>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    const form = document.getElementById("staffForm");
    const heading = document.getElementById("formHeading");
    const urlParams = new URLSearchParams(window.location.search);
    const staffId = urlParams.get('id');

    if (staffId) {
      heading.innerText = "Edit Staff Details";
      const staffList = JSON.parse(localStorage.getItem("staffList")) || [];
      const staff = staffList.find(s => s.staffId === staffId);
      if (staff) {
        Object.keys(staff).forEach(key => {
          const input = document.getElementById(key);
          if (input) input.value = staff[key];
        });
      }
    } else {
      const staffList = JSON.parse(localStorage.getItem("staffList")) || [];
      const newId = ST${staffList.length + 101};
      document.getElementById('staffId').value = newId;
    }

    form.addEventListener("submit", (event) => {
      event.preventDefault();
      let staffList = JSON.parse(localStorage.getItem("staffList")) || [];
      const staffData = {};
      new FormData(form).forEach((value, key) => staffData[key] = value);

      const existingIndex = staffList.findIndex(s => s.staffId === staffData.staffId);
      if (existingIndex > -1) {
        staffList[existingIndex] = staffData;
        alert("Staff updated successfully!");
      } else {
        staffList.push(staffData);
        alert("Staff added successfully!");
      }

      localStorage.setItem("staffList", JSON.stringify(staffList));
      window.location.href = "staff.html";
    });

    // âœ… Update parent title
    if (window.parent) {
      window.parent.postMessage({
        type: 'updateTitle',
        title: staffId ? 'Edit Staff' : 'Add New Staff',
        showBack: true
      }, '*');
    }
  </script>
</body>

</html>