<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>View Attendance</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
</head>

<body>
  <div class="container mt-2">
    <h2 id="classTitle" class="mb-3">Attendance</h2>

    <div class="table-responsive">
      <table class="table table-bordered table-hover">
        <thead class="table-dark">
          <tr>
            <th>Device ID</th>
            <th>Student ID</th>
            <th>Student Name</th>
            <th>Class</th>
            <th>Section</th>
            <th>Status</th>
            <th>Date</th>
          </tr>
        </thead>
        <tbody id="attendanceTable">
        </tbody>
      </table>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    // ✅ Use a consistent dataset
    const attendanceData = [{
      deviceId: "D001",
      id: "S101",
      name: "Rahul",
      class: "1",
      section: "A",
      date: "2025-06-08",
      status: "Present"
    }, {
      deviceId: "D002",
      id: "S102",
      name: "Ram",
      class: "1",
      section: "A",
      date: "2025-06-08",
      status: "Present"
    }, {
      deviceId: "D003",
      id: "S103",
      name: "Sam",
      class: "2",
      section: "B",
      date: "2025-06-08",
      status: "Absent"
    }, {
      deviceId: "D004",
      id: "S104",
      name: "Tom",
      class: "3",
      section: "A",
      date: "2025-06-07",
      status: "Late"
    }, {
      deviceId: "D001",
      id: "S101",
      name: "Amit Sharma",
      class: "5",
      section: "A",
      status: "Present",
      date: "2025-09-17"
    }, {
      deviceId: "D001",
      id: "S102",
      name: "Riya Verma",
      class: "5",
      section: "A",
      status: "Absent",
      date: "2025-09-17"
    }, {
      deviceId: "D002",
      id: "S103",
      name: "Kunal Singh",
      class: "6",
      section: "B",
      status: "Late",
      date: "2025-09-17"
    },];

    // Get class from query parameter
    const urlParams = new URLSearchParams(window.location.search);
    const selectedClass = urlParams.get('class');

    document.getElementById('classTitle').innerText = Attendance - Class ${ selectedClass };

    function renderAttendance() {
      const tbody = document.getElementById("attendanceTable");
      tbody.innerHTML = "";
      const filtered = attendanceData.filter(a => a.class === selectedClass);
      if (filtered.length === 0) {
        tbody.innerHTML = <tr><td colspan="7" class="text-center text-muted">No records found</td></tr>;
        return;
      }

      filtered.forEach(a => {
        tbody.innerHTML += `
          <tr>
            <td>${a.deviceId}</td>
            <td>${a.id}</td>
            <td>${a.name}</td>
            <td>${a.class}</td>
            <td>${a.section}</td>
            <td>${a.status}</td>
            <td>${a.date}</td>
          </tr>
        `;
      });
    }

    renderAttendance();

    // ✅ Tell the parent page to update the title
    if (window.parent) {
      window.parent.postMessage({
        type: 'updateTitle',
        title: Attendance - Class ${ selectedClass },
        showBack: true
      }, '*');
    }
  </script>
</body>

</html>